{% extends "base.html" %}
{% block title %}Atendimento {{ ticket.protocol }}{% endblock %}
{% block content %}
    <h3>Detalhes do Atendimento: #{{ ticket.protocol }}</h3>
    <p><strong>Título:</strong> {{ ticket.title }}</p>
    <p><strong>Status:</strong> {{ ticket.status.value }}</p>
    <p><strong>Prioridade:</strong> {{ ticket.priority.value }}</p>
    <p><strong>Descrição:</strong><br>{{ ticket.description }}</p>
    <hr>

    <h4>Mensagens</h4>
    <div class="messages-box" style="border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll;">
        {% for message in ticket.messages %}
            <p><strong>{{ message.author.name }}</strong> ({{ message.created_at.strftime('%d/%m/%Y %H:%M') }}):<br>{{ message.content }}</p>
        {% endfor %}
    </div>

    <form method="POST" class="mt-3">
        <div class="form-group">
            <textarea name="message" class="form-control" rows="3" placeholder="Digite sua mensagem..."></textarea>
        </div>
        
        {% if current_user.is_admin %}
        <div class="form-group">
            <label for="status">Alterar Status</label>
            <select name="status" class="form-control">
                {% for s in statuses %}
                <option value="{{ s.name }}" {% if ticket.status == s %}selected{% endif %}>{{ s.value }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <button type="submit" class="btn btn-primary">Enviar</button>
    </form>
{% endblock %}